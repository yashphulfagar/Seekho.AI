<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='chatbot.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <div>
        <div>
            <nav class="navbar navbar-expand-lg bg-body-tertiary" style="border-bottom: 1px grey groove;">
                <a class="navbar-brand" href="/dashboard" style="margin-left: 20px;">
                    <img src="{{ url_for('static', filename='iitm-logo.png') }}" alt="IITM Logo" height="32"
                        class="d-inline-block align-text-top" />
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText"
                    aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarText">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <span class="navbar-text">
                            <b>May 2024 - Software Engineering</b>
                        </span>
                    </ul>
                    <span class="navbar-text" style="margin-right: 10px;">
                        admin@ds.study.iitm.ac.in
                    </span>
                    <span class="navbar-text">
                        <a href="/"><svg _ngcontent-mlo-c14="" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24" class="ng-tns-c14-0">
                                <title _ngcontent-mlo-c14="" class="ng-tns-c14-0">Logout</title>
                                <g _ngcontent-mlo-c14="" fill="none" fill-rule="evenodd" class="ng-tns-c14-0">
                                    <path _ngcontent-mlo-c14="" fill="#8f90a6"
                                        d="M19 4c.552 0 1 .448 1 1v14c0 .552-.448 1-1 1h-2c-.552 0-1-.448-1-1s.448-1 1-1h1V6h-1c-.552 0-1-.448-1-1s.448-1 1-1zm-8.6 3.2c.442-.331 1.069-.242 1.4.2l3.02 4.02c.257.351.257.829 0 1.18l-2.82 4c-.187.262-.488.419-.81.42l-.124-.007c-.163-.019-.32-.078-.456-.173l-.004-.003c-.453-.323-.557-.948-.236-1.397L12.09 13H4c-.552 0-1-.448-1-1s.448-1 1-1h8l-1.8-2.4c-.331-.442-.242-1.069.2-1.4z"
                                        class="ng-tns-c14-0"></path>
                                </g>
                            </svg></a>
                    </span>
                </div>
            </nav>
        </div>
        <div>
            <div class="div2">
                <div class="d-flex flex-column flex-shrink-0 bg-light"
                    style="width: 5.0rem;height: 100vh; border-right: 1px grey groove;">
                    <ul class="nav nav-pills nav-flush flex-column mb-auto text-center">
                        <li>
                            <a href="{{ url_for('dashboard') }}" class="nav-link py-3 border-bottom" title="" data-bs-toggle="tooltip"
                                data-bs-placement="right" data-bs-original-title="Dashboard">
                                <img src="{{ url_for('static', filename='module.png') }}" alt="Module"
                                    class="sidebar_icon" width="50" height="50" />
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('grades') }}" class="nav-link py-3 border-bottom" title="" data-bs-toggle="tooltip"
                                data-bs-placement="right" data-bs-original-title="Grades">
                                <img src="{{ url_for('static', filename='grade.png') }}" alt="Grade"
                                    class="sidebar_icon" width="50" height="50" />
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link py-3 border-bottom" title="" data-bs-toggle="tooltip"
                                data-bs-placement="right" data-bs-original-title="Inbox">
                                <img src="{{ url_for('static', filename='inbox.png') }}" alt="Inbox"
                                    class="sidebar_icon" onclick="openGmail()" width="50" height="50" />
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link py-3 border-bottom" title="" data-bs-toggle="tooltip"
                                data-bs-placement="right" data-bs-original-title="Discuss">
                                <img src="{{ url_for('static', filename='discuss.png') }}" alt="Discuss"
                                    class="sidebar_icon" onclick="openDiscourse()" width="50" height="50" />
                            </a>
                        </li>
                        <li>
                            <a href="https://www.tcsion.com/OnlineAssessment/ScientificCalculator/Calculator.html"
                                target="_blank" class="nav-link py-3 border-bottom" title="" data-bs-toggle="tooltip"
                                data-bs-placement="right" data-bs-original-title="Calculator">
                                <img src="{{ url_for('static', filename='calc.png') }}" alt="Calc" class="sidebar_icon"
                                    id="calc-icon" width="50" height="50" />
                                <p style="font-size:x-small; color: black;margin: 0%;">Calculator</p>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('chatbot') }}" class="nav-link py-3 border-bottom" title=""
                                data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Chatbot">
                                <img src="{{ url_for('static', filename='chatbot.png') }}" alt="ChatBot"
                                    class="sidebar_icon" width="50" height="50" />
                                <p style="font-size:x-small; color: black;margin: 0%;">Course Chatbot</p>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div>
                <div class="div4outer">
                    <div>
                        <span class="topic">
                            <h5 style="text-align: center;">Student Chatbot -Software Engineering</h5>
                        </span>
                        <div class="chat-container" id="chat-container"></div>
                        <div class="message-box-container">
                            <div class="message-box">
                                <textarea id="user-input" placeholder="Type your message here..." rows="2"
                                    style="flex: 1; border: none; outline: none; resize: none;"></textarea>
                                <button class="send-button" onclick="sendMessage()">
                                    <img src="{{ url_for('static', filename='send.png') }}" alt="Send" class="send">
                                </button>
                                <button class="send-button" onclick="clearChat()">
                                    <img src="{{ url_for('static', filename='bin.png') }}" alt="Send" class="clear">
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <script>
                function openDiscourse() {
                    window.open("https://discourse.onlinedegree.iitm.ac.in/", "_blank");
                }
                function openGmail() {
                    window.open("https://mail.google.com/mail/u/0/#inbox", "_blank");
                }
                let chatSessionCounter = 1;
                let chatHistory = {};

                async function sendMessage() {
                    const userInput = document.getElementById('user-input').value;
                    if (userInput.trim() === '') return;

                    const chatContainer = document.getElementById('chat-container');

                    // Add user message to chat
                    const userMessageDiv = document.createElement('div');
                    userMessageDiv.classList.add('user-message');
                    userMessageDiv.innerHTML = `
        <span class="username">
            <img src="{{ url_for('static', filename='userimage.jpg') }}" alt="userimage" class="userimage" />
        </span>
        <div class="message">${userInput}</div>
    `;
                    chatContainer.appendChild(userMessageDiv);

                    // Clear user input
                    document.getElementById('user-input').value = '';

                    // Send message to backend
                    const response = await fetch('/api/chatbot_page', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message: userInput }),
                    });
                    const data = await response.json();

                    // Add chatbot response to chat
                    const botMessageDiv = document.createElement('div');
                    botMessageDiv.classList.add('chatbot-message');
                    botMessageDiv.innerHTML = `
        <span class="username">
            <img src="{{ url_for('static', filename='chatbotimage.png') }}" alt="chatbot" class="chatbotimage" />
        </span>
        <div class="message">${data.response}</div>
    `;
                    chatContainer.appendChild(botMessageDiv);

                    scrollToBottom()
                }

                function clearChat() {
                    document.getElementById('chat-container').innerHTML = '';
                    document.getElementById('chat-history-list').innerHTML = '';
                    chatHistory = {};
                    chatSessionCounter = 1;
                }
                let chatHistories = {};

                function displayMessage(message) {
                    const chatContainer = document.querySelector('.chat-container');
                    const messageElement = document.createElement('div');
                    messageElement.className = message.sender === 'user' ? 'user-message' : 'chatbot-message';
                    messageElement.innerHTML = `<div class="message">${message.text}</div>`;
                    chatContainer.appendChild(messageElement);
                }

                function scrollToBottom() {
                    const chatContainer = document.querySelector('.chat-container');
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }
            </script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
                crossorigin="anonymous">
                </script>
</body>

</html>